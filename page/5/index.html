<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"pumpkinjimmy.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="BBPumpkin的个人博客( •̀ ω •́ )y">
<meta property="og:type" content="website">
<meta property="og:title" content="BBPumpkin的博客">
<meta property="og:url" content="http://pumpkinjimmy.github.io/page/5/index.html">
<meta property="og:site_name" content="BBPumpkin的博客">
<meta property="og:description" content="BBPumpkin的个人博客( •̀ ω •́ )y">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="BBPumpkin">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://pumpkinjimmy.github.io/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>BBPumpkin的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">BBPumpkin的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://pumpkinjimmy.github.io/posts/115de870/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BBPumpkin">
      <meta itemprop="description" content="BBPumpkin的个人博客( •̀ ω •́ )y">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BBPumpkin的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/115de870/" class="post-title-link" itemprop="url">自由曲面建模</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-26 02:05:30" itemprop="dateCreated datePublished" datetime="2021-11-26T02:05:30+08:00">2021-11-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-08 18:10:11" itemprop="dateModified" datetime="2023-06-08T18:10:11+08:00">2023-06-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="%E8%87%AA%E7%94%B1%E6%9B%B2%E9%9D%A2%E5%BB%BA%E6%A8%A1" tabindex="-1">自由曲面建模</h1>
<h2 id="%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E9%9D%A2" tabindex="-1">贝塞尔曲面</h2>
<p>显然参照贝塞尔曲线，贝塞尔曲面是两个参数<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo separator="true">,</mo><mi>v</mi></mrow><annotation encoding="application/x-tex">u,v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span></eq>的参数曲面：</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>B</mi><mo>:</mo><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo stretchy="false">)</mo><mo>→</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">
    B: (u,v) \to (x,y,z)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span></span></eqn></section><h3 id="%E5%9F%BA%E5%87%BD%E6%95%B0" tabindex="-1">基函数</h3>
<ul>
<li>分别对两个参数构造伯恩斯坦基</li>
<li><strong>对两组基作笛卡尔积得到曲面</strong></li>
</ul>
<h3 id="%E6%8E%A7%E5%88%B6" tabindex="-1">控制</h3>
<p>使用<em>控制多边形</em>而不是控制点来控制曲线形状</p>
<h2 id="b%E6%A0%B7%E6%9D%A1%E6%9B%B2%E9%9D%A2%EF%BC%88%E5%BE%85%E5%AE%8C%E5%96%84%EF%BC%89" tabindex="-1">B样条曲面（待完善）</h2>
<h2 id="nurbs%3A-%E9%9D%9E%E5%9D%87%E5%8C%80%E6%9C%89%E7%90%86b%E6%A0%B7%E6%9D%A1" tabindex="-1">NURBS: 非均匀有理B样条</h2>
<p>贝塞尔/B样条都搞不定很简单的二次曲线/曲面：圆、椭圆、抛物线、双曲线</p>
<p>通过引入控制点以及<em>权值</em>，可以引入NURBS自由曲线建模。</p>
<p>这个模型更复杂，但是更全能。</p>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.min.css">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://pumpkinjimmy.github.io/posts/fe48acc4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BBPumpkin">
      <meta itemprop="description" content="BBPumpkin的个人博客( •̀ ω •́ )y">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BBPumpkin的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/fe48acc4/" class="post-title-link" itemprop="url">Static Game（待完善）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-25 06:50:05" itemprop="dateCreated datePublished" datetime="2021-11-25T06:50:05+08:00">2021-11-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-08 18:10:11" itemprop="dateModified" datetime="2023-06-08T18:10:11+08:00">2023-06-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="static-game%EF%BC%88%E5%BE%85%E5%AE%8C%E5%96%84%EF%BC%89" tabindex="-1">Static Game（待完善）</h1>
<p>Static Game: <em>每个参与者独立、同时作出决策</em></p>
<h2 id="%E5%89%8D%E8%A8%80%EF%BC%9A%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93%E5%8D%9A%E5%BC%88" tabindex="-1">前言：多智能体博弈</h2>
<p>多智能体博弈之所以不能简化为单智能体的优化是因为在多智能体博弈中<strong>博弈的均衡点不一定在对所有人都最好的情况下</strong>，比如囚徒困境。</p>
<h2 id="%E5%9B%9A%E5%BE%92%E5%9B%B0%E5%A2%83" tabindex="-1">囚徒困境</h2>
<h2 id="%E5%B8%95%E7%B4%AF%E6%89%98%E6%9C%80%E4%BC%98" tabindex="-1">帕累托最优</h2>
<h2 id="dominant" tabindex="-1">Dominant</h2>
<p>若对于一个智能体而言，在<em>任何情况下</em>一个决策的收益都<em>大于</em>另一个的收益，则称这个决策*优于(Strictly Dominant)*另一个决策。</p>
<p>把大于改成大于等于就会得到<em>Weakly Dominant</em></p>
<p>理解：由于每个（纯）决策的效用在不同情况下不同，因此动作的收益可以看作一个向量。我们为向量定义了偏序关系“Dominant”，“Strictly Dominated”意味着一个策略在任何情况下都不是最优的。</p>
<p>Dominant只能用于解决特殊形式的Static Game博弈</p>
<h2 id="%E7%BA%B3%E4%BB%80%E5%9D%87%E8%A1%A1%EF%BC%88ne%EF%BC%89" tabindex="-1">纳什均衡（NE）</h2>
<p><strong>一个被Strictly Dominated的决策不会是纳什均衡策略</strong></p>
<p>但Weakly Dominant的策略可能会被包含</p>
<p>对于Pure Strategy，可能不存在纳什均衡</p>
<h3 id="pure-ne%EF%BC%9Abest-response" tabindex="-1">Pure NE：Best Response</h3>
<p>若存在Pure Strategy <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msubsup><mi>s</mi><mn>1</mn><mo>∗</mo></msubsup><mo separator="true">,</mo><msubsup><mi>s</mi><mn>2</mn><mo>∗</mo></msubsup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_1^*, s_2^*)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></eq>满足：</p>
<ul>
<li><eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi><mo stretchy="false">(</mo><msubsup><mi>s</mi><mn>1</mn><mo>∗</mo></msubsup><mo separator="true">,</mo><msubsup><mi>s</mi><mn>2</mn><mo>∗</mo></msubsup><mo stretchy="false">)</mo><mo>≥</mo><mi>π</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mn>1</mn></msub><mo separator="true">,</mo><msubsup><mi>s</mi><mn>2</mn><mo>∗</mo></msubsup><mo stretchy="false">)</mo><mo separator="true">,</mo><mi mathvariant="normal">∀</mi><msub><mi>s</mi><mn>1</mn></msub><mo>∈</mo><msub><mi mathvariant="bold">S</mi><mn mathvariant="bold">1</mn></msub></mrow><annotation encoding="application/x-tex">\pi(s_1^*, s_2^*) \ge \pi(s_1, s_2^*), \forall s_1 \in \mathbf{S_1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">∀</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8361em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathbf">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq></li>
<li><eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi><mo stretchy="false">(</mo><msubsup><mi>s</mi><mn>1</mn><mo>∗</mo></msubsup><mo separator="true">,</mo><msubsup><mi>s</mi><mn>2</mn><mo>∗</mo></msubsup><mo stretchy="false">)</mo><mo>≥</mo><mi>π</mi><mo stretchy="false">(</mo><msubsup><mi>s</mi><mn>1</mn><mo>∗</mo></msubsup><mo separator="true">,</mo><msub><mi>s</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mi mathvariant="normal">∀</mi><msub><mi>s</mi><mn>2</mn></msub><mo>∈</mo><msub><mi mathvariant="bold">S</mi><mn mathvariant="bold">2</mn></msub></mrow><annotation encoding="application/x-tex">\pi(s_1^*, s_2^*) \ge \pi(s_1^*, s_2), \forall s_2 \in \mathbf{S_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">∀</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8361em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathbf">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq></li>
</ul>
<p><strong>同时成立</strong>，则<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msubsup><mi>s</mi><mn>1</mn><mo>∗</mo></msubsup><mo separator="true">,</mo><msubsup><mi>s</mi><mn>2</mn><mo>∗</mo></msubsup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_1^*,s_2^*)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></eq>是一个Pure Strategy NE</p>
<p>利用这个定理可以快速找出pure strategy NE：只需要找出在每一个Player在对手每一个可能的action下最佳的应对“Best Response”，然后选出那些Best Response重叠的点，就是NE</p>
<h3 id="mixed-ne%3A-equality-of-payoff" tabindex="-1">Mixed NE: Equality of Payoff</h3>
<h4 id="%E6%94%AF%E6%92%91%E9%9B%86(support)%E7%9A%84%E5%AE%9A%E4%B9%89" tabindex="-1">支撑集(Support)的定义</h4>
<p>Mixed Strategy <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span></span></eq>的支撑集<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>S</mi><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">S^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6887em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span></eq>定义为<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mi>s</mi><mtext> </mtext><mi mathvariant="normal">∣</mi><mtext> </mtext><msub><mi>p</mi><mi>σ</mi></msub><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo><mo>&gt;</mo><mn>0</mn><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{s \ |\ p_{\sigma}(s) &gt; 0\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">s</span><span class="mspace"> </span><span class="mord">∣</span><span class="mspace"> </span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mclose">}</span></span></span></span></eq></p>
<p>当到达纳什均衡时，<strong>对于每一个Player而言，Support中的任何Pure Strategy的收益等于NE的收益</strong></p>
<p>可以利用上述的定义来列出等式来求解Mixed-strategy NE。</p>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.min.css">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://pumpkinjimmy.github.io/posts/ebd44359/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BBPumpkin">
      <meta itemprop="description" content="BBPumpkin的个人博客( •̀ ω •́ )y">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BBPumpkin的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/ebd44359/" class="post-title-link" itemprop="url">分布式系统的一致性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-19 07:53:58" itemprop="dateCreated datePublished" datetime="2021-11-19T07:53:58+08:00">2021-11-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-08 18:10:11" itemprop="dateModified" datetime="2023-06-08T18:10:11+08:00">2023-06-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7" tabindex="-1">分布式系统的一致性</h1>
<h2 id="%E5%89%8D%E8%A8%80" tabindex="-1">前言</h2>
<p>以下讨论的一致性是狭义上的<em>进程</em>之间的一致性。</p>
<h2 id="cap%E5%AE%9A%E7%90%86" tabindex="-1">CAP定理</h2>
<p>CAP定理是指分布式系统中，Consistency（一致性）, Availability（可用性）, Partition tolerance（分区容错性）<strong>不可兼得</strong></p>
<ul>
<li>一致性：进程之间保持绝对的共识</li>
<li>可用性：任何时刻保证进程是可以正常服务的</li>
<li>分区容错性：（待完善）</li>
</ul>
<p>实际中将不得不对这三个因素，尤其是C和A做权衡：</p>
<ul>
<li>常见的事务系统（如银行）必须保证一致性，代价是会影响可用性（其实就是慢）</li>
</ul>
<h2 id="%E5%A4%8D%E5%88%B6%EF%BC%88replication%EF%BC%89" tabindex="-1">复制（Replication）</h2>
<p>复制的目的：</p>
<ul>
<li>性能</li>
<li><strong>可用性</strong></li>
</ul>
<p>复制的主要问题：<strong>一致性问题</strong></p>
<p>保证副本之间的一致性所面临的挑战：</p>
<ul>
<li>确保临界操作都要正确互斥</li>
<li><strong>在所有副本之间的必须以相同的顺序执行临界操作</strong></li>
<li>保证全局一致性的代价太高，可能只能做到<em>最终一致性</em></li>
</ul>
<p>面临的临界操作冲突：</p>
<ul>
<li>读写冲突</li>
<li>写写冲突<br>
（注意：读和读之间是可以并发的，不存在冲突）</li>
</ul>
<p>三个级别的一致性模型：</p>
<ol>
<li>连续一致性</li>
<li>因果一致性</li>
<li>最终一致性</li>
</ol>
<h2 id="%E4%BB%A5%E6%95%B0%E6%8D%AE%E4%B8%BA%E4%B8%AD%E5%BF%83%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E6%A8%A1%E5%9E%8B" tabindex="-1">以数据为中心的一致性模型</h2>
<p>说明：一致性的度量是“结果导向”的。也就是说，我们说“一致性”就是说结果的数值是一样的。</p>
<h3 id="%E4%B8%80%E8%87%B4%E6%A0%87%E5%87%86%EF%BC%9A%E8%BF%9E%E7%BB%AD%E4%B8%80%E8%87%B4%E6%80%A7" tabindex="-1">一致标准：连续一致性</h3>
<p>连续一致性：数据一致性的三个维度：</p>
<ol>
<li>数值偏差</li>
<li>新旧偏差</li>
<li>顺序偏差</li>
</ol>
<p>因为绝对的一致性不可实现，实际系统中考察一致性的重要度量就是连续一致性的三个维度：我们能在多大程度上数据的差异我们可以容忍并视作是“等同的”</p>
<ul>
<li>
<p>数值偏差</p>
<p>这是最直观的情形。如果副本之间的某个数据对象具有“数值语义”，则<strong>对象在副本中的绝对值偏差不超过容忍，则认为对象达成一致</strong></p>
</li>
<li>
<p>新旧偏差</p>
<p>对于非数值语义的数据变量，我们认为<strong>不太旧的版本的变量是一致的</strong></p>
</li>
<li>
<p>顺序偏差</p>
</li>
</ul>
<h3 id="%E4%B8%80%E8%87%B4%E7%9A%84%E6%93%8D%E4%BD%9C%E9%A1%BA%E5%BA%8F" tabindex="-1">一致的操作顺序</h3>
<ul>
<li>
<p>顺序一致性</p>
<p>顺序一致性要求<strong>在所有副本上，所有临界操作都以相同的顺序执行</strong></p>
</li>
<li>
<p>因果一致性</p>
<p>因果一致性是弱化的连续一致性。</p>
<p>因果一致性<strong>只要保证Happen-before顺序成立，不要求每个副本上操作执行顺序相同</strong></p>
</li>
</ul>
<h3 id="%E5%88%86%E7%BB%84%E6%93%8D%E4%BD%9C%EF%BC%88%E5%BE%85%E5%AE%8C%E5%96%84%EF%BC%89" tabindex="-1">分组操作（待完善）</h3>
<h2 id="%E4%BB%A5%E5%AE%A2%E6%88%B7%E4%B8%BA%E4%B8%AD%E5%BF%83%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E6%A8%A1%E5%9E%8B%EF%BC%9A%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7" tabindex="-1">以客户为中心的一致性模型：最终一致性</h2>
<p>比因果一致性更弱的一致性的场景：最终一致性。</p>
<p>最终一致性的内涵：<strong>如果系统一直没有修改，则数据的各个副本会逐渐变成一致</strong></p>
<p>最终一致性只要求系统<strong>对于单个客户端自身的“视图”是一致的</strong>，对分布式系统内部状态的一致性没有要求</p>
<p>说明1：以下说明中，强调<em>同一客户端</em>不意味着“同一个副本”。抽象而言，同一个客户端其实是指同一个身份，这个身份可能依赖某种标识手段。</p>
<p>说明2：我们在讨论写读一致性以及单调写时，都存在“写在后”的情况。此时由于没有配套一个读操作，好像写操作带来的“视图”的改变不可知。因此，讨论这两方面时，我们假设<em>存在一个上帝视角可以考察副本中一个对象的值“最终的取值”</em></p>
<p><strong>单调读</strong>：对同一个客户端来说，每次读取同一个变量，<strong>不会得到比之前读的更旧版本的值</strong></p>
<p><strong>单调写</strong>：对同一个客户端来说，<strong>写操作的生效要保证按需生效（Happen-before顺序成立）</strong></p>
<p><strong>读写一致性(read after write)</strong>：</p>
<ul>
<li>对同一个客户端而言，<strong>它的写操作总是在它之后的读取之前完成。写后读到的总是写后值</strong></li>
</ul>
<p><strong>写读一致性(write after read)</strong>：</p>
<ul>
<li>对同一个客户端而言，<strong>它的写操作至少基于最近一次读到的值生效（覆盖最近读到的值）</strong></li>
<li>违反写读一致性的例子：客户端A、B并发，初始<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x=x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq>，客户端A写<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x=x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq>, 客户端B先读<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></eq>，再写<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x=x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq>。此时，客户端读到的值、<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></eq>实际的取值为<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_0, x_1), (x_0, x_2), (x_1, x_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></eq>都是符合最终一致性的，但是若是<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_1, x_1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></eq>，则违反最终一致性。因为读到<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq>之后，对于B而言，写<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq>操作是后发生的，该操作应该覆盖<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq>，但最终不满足这一点，因此不符合最终一致性。</li>
</ul>
<h2 id="%E5%A4%8D%E5%88%B6%E7%AE%A1%E7%90%86" tabindex="-1">复制管理</h2>
<ul>
<li>三类复制：
<ul>
<li>Permenant Replicas</li>
<li>Server-initial Replicas</li>
<li>Client-initial Replicas</li>
</ul>
</li>
<li>更新模式：Push vs. Pull
<ul>
<li>Pull 适合大规模、大量客户端的系统（成本更低），但是需要主动拉去更新</li>
<li>Push 成本更高，但可以同步更新</li>
</ul>
</li>
<li>折中的更新模式：Lease（租约）
<ul>
<li>在Push和Pull之间动态切换</li>
<li><strong>在Lease有效期内对象是基于Push更新的；过期之后就切换为基于Pull的</strong></li>
<li>自适应指定Lease的策略同样有多种</li>
</ul>
</li>
</ul>
<h2 id="%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE%EF%BC%88%E5%BE%85%E5%AE%8C%E5%96%84%EF%BC%89" tabindex="-1">一致性协议（待完善）</h2>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.min.css">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://pumpkinjimmy.github.io/posts/c85b8ed3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BBPumpkin">
      <meta itemprop="description" content="BBPumpkin的个人博客( •̀ ω •́ )y">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BBPumpkin的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/c85b8ed3/" class="post-title-link" itemprop="url">智能合约</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-18 02:11:52" itemprop="dateCreated datePublished" datetime="2021-11-18T02:11:52+08:00">2021-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-08 18:10:11" itemprop="dateModified" datetime="2023-06-08T18:10:11+08:00">2023-06-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6" tabindex="-1">智能合约</h1>
<p>智能合约是一段代码。其本质是<strong>对状态转移的一致认可</strong>。这里的“状态”是整个以太坊系统看作状态机。</p>
<h2 id="%E5%90%88%E7%BA%A6%E8%B4%A6%E6%88%B7" tabindex="-1">合约账户</h2>
<ul>
<li>存储了合约代码（机器码），还存储了合约数据</li>
<li>不由具体公钥和私钥控制</li>
<li>具有地址，可以用于被<em>调用</em>（to字段）</li>
<li>通常不能<em>发起</em>合约。唯一的例外是<strong>合约账号创建合约</strong></li>
<li>账户Nounce通常不变</li>
<li>常用的合约代码语言是Solidity，类似JavaScript</li>
</ul>
<h2 id="%E5%90%88%E7%BA%A6%E5%9C%B0%E5%9D%80" tabindex="-1">合约地址</h2>
<ul>
<li>由于不对应一对密钥，所以生成方法不同于通常账户（从公钥的哈希生成）</li>
<li>两种生成方法：
<ul>
<li>合约创建者的地址和Nounce</li>
<li>合约创建者的地址、Nounce和代码</li>
</ul>
</li>
</ul>
<h2 id="%E8%B0%83%E7%94%A8%E5%90%88%E7%BA%A6" tabindex="-1">调用合约</h2>
<h3 id="%E5%A6%82%E4%BD%95%E5%8F%91%E8%B5%B7%E8%B0%83%E7%94%A8" tabindex="-1">如何发起调用</h3>
<p>使用如下方法调用合约：</p>
<ol>
<li>发起一笔交易，使用<strong>合约账户的地址</strong>作为<strong>接收方</strong></li>
<li>发起者在交易中声明合约函数调用的参数</li>
</ol>
<p>实际实现中，使用“函数名的哈希+参数值”的序列化作为一个具体合约函数调用的表示。</p>
<p>注意，在一次合约调用中，<strong>一旦出现任何异常，整个调用操作会全部回滚</strong></p>
<h3 id="%E5%B8%B8%E8%A7%81%E8%B0%83%E7%94%A8%EF%BC%88%E5%BE%85%E5%AE%8C%E5%96%84%EF%BC%89" tabindex="-1">常见调用（待完善）</h3>
<p>注意，以下这些操作<strong>都需要花费Gas</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">call()</span><br><span class="line">callcode()</span><br><span class="line">delegatecall()</span><br><span class="line"></span><br><span class="line">balance()</span><br><span class="line">transfer()</span><br><span class="line">send()</span><br></pre></td></tr></table></figure>
<p>以下三个操作可以转账（发送ETH）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">transfer()</span><br><span class="line">send()</span><br><span class="line">call.value()</span><br></pre></td></tr></table></figure>
<h2 id="%E5%88%9B%E5%BB%BA%E5%90%88%E7%BA%A6" tabindex="-1">创建合约</h2>
<p>步骤：</p>
<ol>
<li>创建合约账户</li>
<li><strong>发起交易，将代码存储到以太坊合约账户中</strong></li>
</ol>
<p>这个过程也称为合约的<em>部署</em></p>
<p>创建合约的交易的说明:</p>
<ol>
<li><code>To=0</code>，即<strong>没有接收地址</strong></li>
<li>合约代码和初始化数据放在交易的data字段中</li>
</ol>
<h2 id="%E5%81%9C%E6%9C%BA%E9%97%AE%E9%A2%98%E4%B8%8Egas" tabindex="-1">停机问题与Gas</h2>
<ul>
<li>
<p>停机问题</p>
<p><strong>图灵机上，一个程序是否在有限时间内结束，是一个不可判定问题</strong></p>
</li>
<li>
<p>在区块链上允许运行任何用户代码的智能合约需要保证代码能够停机</p>
</li>
<li>
<p>解决方法：<strong>运行代码中的每个指令都需要消耗Gas</strong></p>
<ul>
<li>在调用智能合约时，需要预先支付Gas</li>
<li>运行过程中代码不断消耗预先支付的Gas</li>
<li>若Gas用完了，则代码停机</li>
<li>否则，合约运行完成，返还未用完的Gas</li>
<li>本质上这种停机是承诺“代码在k步内结束”</li>
</ul>
</li>
<li>
<p>Gas的几个量</p>
<ul>
<li>
<p>Gas</p>
</li>
<li>
<p>GasLimit Gas消耗上限</p>
<p>一旦Gas消耗超过GasLimit会终止合约执行、抛出异常并回滚。</p>
</li>
<li>
<p>GasUsed 实际消耗的Gas</p>
</li>
<li>
<p>GasPrice Gas到ETH的汇率</p>
</li>
</ul>
</li>
<li>
<p>Gas的弊端</p>
<ul>
<li>合约操作的Gas定价是开发者（运行代码的矿工组织）决定的</li>
</ul>
</li>
</ul>
<h2 id="%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86" tabindex="-1">异常处理</h2>
<ul>
<li>
<p>没有<code>try-catch</code>异常处理结构，任何错误都会导致异常抛出和回滚</p>
</li>
<li>
<p><code>call/callcode/delegatecall</code>中子调用的异常只会回滚子调用，不会让整个合约运行回滚</p>
</li>
<li>
<p>智能合约的原子性：</p>
<p>一次合约调用中，其中所有操作<strong>要么全部生效，要么全部不生效</strong>。这种类似事务的特性对类似资产交换的场景尤为重要。</p>
</li>
</ul>
<h2 id="evm%EF%BC%88%E4%BB%A5%E5%A4%AA%E5%9D%8A%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%89" tabindex="-1">EVM（以太坊虚拟机）</h2>
<p>考虑：如何运行合约代码？</p>
<ol>
<li>
<p>高层的语言（脚本语言）</p>
<p>由于节点配置不同，难以保证一致性</p>
</li>
<li>
<p>机器码</p>
<p>这样的程序与特定架构绑定，不适用高度异构的去中心化分布式系统</p>
</li>
<li>
<p>折中：<strong>虚拟化</strong></p>
<p>使用虚拟机</p>
</li>
</ol>
<p>以太坊使用虚拟化方案，也就是EVM。</p>
<p>具体来说</p>
<ul>
<li>使用高层语言（如Solidity）编写源代码</li>
<li>将代码编译成EVM字节码存储和运行</li>
</ul>
<h2 id="%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E7%9A%84%E7%BC%BA%E9%99%B7%E4%B8%8E%E6%94%BB%E5%87%BB%EF%BC%88%E5%BE%85%E5%AE%8C%E5%96%84%EF%BC%89" tabindex="-1">智能合约的缺陷与攻击（待完善）</h2>
<p>重入攻击（区别重放攻击）</p>
<p>一旦代码不完善，可能导致：</p>
<ol>
<li>钱永远锁在合约账户中取不出来</li>
<li>遭遇重入攻击，导致金钱损失</li>
<li>合约代码一经发布后不可篡改</li>
<li>在区块链系统中，<strong>智能合约的代码是法律</strong>。但即便宪法都是可以修改的，但合约却永远不能修改。</li>
</ol>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.min.css">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://pumpkinjimmy.github.io/posts/9f649fbe/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BBPumpkin">
      <meta itemprop="description" content="BBPumpkin的个人博客( •̀ ω •́ )y">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BBPumpkin的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/9f649fbe/" class="post-title-link" itemprop="url">形态学运算</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-16 06:41:45" itemprop="dateCreated datePublished" datetime="2021-11-16T06:41:45+08:00">2021-11-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-08 18:10:11" itemprop="dateModified" datetime="2023-06-08T18:10:11+08:00">2023-06-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="%E5%BD%A2%E6%80%81%E5%AD%A6%E8%BF%90%E7%AE%97" tabindex="-1">形态学运算</h1>
<h2 id="%E5%9F%BA%E6%9C%AC%E8%BF%90%E7%AE%97%EF%BC%88%E5%BE%85%E5%AE%8C%E5%96%84%EF%BC%89" tabindex="-1">基本运算（待完善）</h2>
<ul>
<li>膨胀</li>
<li>腐蚀</li>
<li>开运算</li>
<li>闭运算</li>
<li>击中运算</li>
</ul>
<h3 id="%E5%87%BB%E4%B8%AD-%E5%87%BB%E4%B8%8D%E4%B8%AD%E8%BF%90%E7%AE%97" tabindex="-1">击中-击不中运算</h3>
<p>这个运算的含义其实是<strong>精确匹配</strong>：</p>
<p>只有当<strong>结构元素取1的点在原集合中也取1，结构元素取0的点原集合中也取0</strong>才算是“击中”点，运算结果才是1.</p>
<h2 id="%E5%B8%B8%E7%94%A8%E7%AE%97%E6%B3%95" tabindex="-1">常用算法</h2>
<ul>
<li>图形匹配：击中/击不中运算</li>
<li>边缘提取：基于形态学梯度</li>
<li>区域填充</li>
<li>求连通分量</li>
<li>求凸壳</li>
</ul>
<h3 id="%E5%87%BB%E4%B8%AD%E8%BF%90%E7%AE%97%E5%9B%BE%E5%BD%A2%E5%8C%B9%E9%85%8D" tabindex="-1">击中运算图形匹配</h3>
<p>略</p>
<h3 id="%E5%BD%A2%E6%80%81%E5%AD%A6%E6%A2%AF%E5%BA%A6" tabindex="-1">形态学梯度</h3>
<p>其实就是膨胀减腐蚀</p>
<h3 id="%E5%8C%BA%E5%9F%9F%E5%A1%AB%E5%85%85" tabindex="-1">区域填充</h3>
<h3 id="%E6%B1%82%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F" tabindex="-1">求连通分量</h3>
<p>迭代算法如下：</p>
<ul>
<li>利用模板表示4-临界/8-临界</li>
<li>从集合的任意一个点开始，利用模板膨胀</li>
<li>膨胀结果再对原集合做交集</li>
<li>若某次迭代后集合不变，则迭代结束</li>
</ul>
<h3 id="%E6%B1%82%E5%87%B8%E5%A3%B3" tabindex="-1">求凸壳</h3>
<ul>
<li>凸壳：包含集合的最小凸集</li>
<li>凸缺：凸壳减原来的集合</li>
</ul>
<p>方法利用击中击不中运算迭代。</p>
<p>需要构造四个方向的特殊模板。</p>
<p>四个方向的迭代都结束之后，最后利用初始集合的包围盒裁剪得到凸壳。</p>
<h3 id="%E7%BB%86%E5%8C%96" tabindex="-1">细化</h3>
<p>其实就是对给定的集合和结构元素（或结构元素集），<strong>丢弃所有的击中点</strong></p>
<h3 id="%E7%B2%97%E5%8C%96" tabindex="-1">粗化</h3>
<p>将击中点也包含在内。</p>
<p>通常通过对补集细化来对原集粗化。注意最终需要消除不连通点才是完整结果。</p>
<h3 id="%E9%AA%A8%E6%9E%B6" tabindex="-1">骨架</h3>
<p>骨架是<em>最大内接圆的圆心的集合</em></p>
<p>算法：<em>k级骨架</em>就是k阶腐蚀减去k阶开运算的结果。我们可以用所有级的骨架并在一起充当骨架。</p>
<h3 id="%E8%A3%81%E5%89%AA" tabindex="-1">裁剪</h3>
<p>清除毛刺。</p>
<p>步骤如下：</p>
<ol>
<li>细化</li>
<li>提取终点</li>
<li>限制膨胀</li>
<li>并回去，得到结果</li>
</ol>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.min.css">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://pumpkinjimmy.github.io/posts/21d1d2b7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BBPumpkin">
      <meta itemprop="description" content="BBPumpkin的个人博客( •̀ ω •́ )y">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BBPumpkin的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/21d1d2b7/" class="post-title-link" itemprop="url">数据库：索引</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-15 03:12:51" itemprop="dateCreated datePublished" datetime="2021-11-15T03:12:51+08:00">2021-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-08 18:10:11" itemprop="dateModified" datetime="2023-06-08T18:10:11+08:00">2023-06-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%9A%E7%B4%A2%E5%BC%95" tabindex="-1">数据库：索引</h1>
<h2 id="%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6" tabindex="-1">索引文件</h2>
<p>索引文件是存放索引记录的文件。</p>
<p>索引记录结构：</p>
<ol>
<li>搜索码</li>
<li>指针（数据记录的位置）</li>
</ol>
<h2 id="%E7%B4%A2%E5%BC%95%E7%9A%84%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87" tabindex="-1">索引的性能指标</h2>
<ul>
<li>支持的访问类型
<ul>
<li>B+树索引支持高效的范围查询</li>
<li>哈希索引支持最高效的单点查询但不支持范围查询</li>
</ul>
</li>
<li>访问时间</li>
<li>修改的维护时间</li>
<li>空间开销</li>
</ul>
<h2 id="%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%9E%8B%EF%BC%88%E5%BE%85%E5%AE%8C%E5%96%84%EF%BC%89" tabindex="-1">索引类型（待完善）</h2>
<h3 id="%E9%A1%BA%E5%BA%8F%E7%B4%A2%E5%BC%95" tabindex="-1">顺序索引</h3>
<ul>
<li>聚簇索引（<em>primary key</em> 主索引）</li>
<li>非聚簇索引（<em>secondary key</em> 辅索引）</li>
</ul>
<h2 id="b%2B%E6%A0%91%E7%B4%A2%E5%BC%95%EF%BC%88%E5%BE%85%E5%AE%8C%E5%96%84%EF%BC%89" tabindex="-1">B+树索引（待完善）</h2>
<h3 id="b%2B%E6%A0%91%E7%BB%93%E6%9E%84%E4%B8%8E%E6%80%A7%E8%B4%A8" tabindex="-1">B+树结构与性质</h3>
<ul>
<li>多叉的严格平衡搜索树：根节点到任意叶子节点的距离都相等</li>
<li>设最大分叉数为<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></eq>，则：
<ul>
<li>节点可存放的key数目上限为<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></eq></li>
<li><strong>叶节点存放的key数目的取值范围是<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo stretchy="false">⌈</mo><mo stretchy="false">(</mo><mi>m</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn><mo stretchy="false">⌉</mo><mo separator="true">,</mo><mi>m</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[\lceil (m-1)/2\rceil, m-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[⌈(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">/2</span><span class="mclose">⌉</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span></eq></strong>（小心，下限不等于最小扇出数-1）</li>
<li><strong>根节点分叉数目取值范围<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>2</mn><mo separator="true">,</mo><mi>m</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[2,m]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mclose">]</span></span></span></span></eq></strong></li>
<li><strong>非根非叶节点分叉数目取值范围<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo stretchy="false">⌈</mo><mi>m</mi><mi mathvariant="normal">/</mi><mn>2</mn><mo stretchy="false">⌉</mo><mo separator="true">,</mo><mi>m</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[\lceil m/2\rceil, m]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[⌈</span><span class="mord mathnormal">m</span><span class="mord">/2</span><span class="mclose">⌉</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mclose">]</span></span></span></span></eq></strong></li>
<li>所有叶子节点利用最后一个指针的空间作为后继指针，串成一个有序链表</li>
<li>（区别于B树）<strong>所有Key对应的Value只存放在叶节点上</strong></li>
<li>作为将所有Key放在叶子上的收益，叶子节点串成的有序链表可以高效地实现范围查询：只需要找到端点值对应的指针就可以顺序输出</li>
<li>作为将所有Key放在叶子上的代价，叶节点和非叶几点必须分开处理：叶节点上的Key在分裂时不能直接抽取到非叶节点上，而是冗余存储Key；但在非叶节点上却依然可以有这样的抽取Key的建树行为。</li>
</ul>
</li>
</ul>
<h3 id="b%2B%E6%A0%91%E6%9F%A5%E6%89%BE" tabindex="-1">B+树查找</h3>
<p>从查找的角度，B+树可以看作特殊构造的非聚簇的多级顺序索引</p>
<h3 id="b%2B%E6%A0%91%E6%8F%92%E5%85%A5" tabindex="-1">B+树插入</h3>
<p>主要是利用<em>分裂</em>和<em>增高</em>来维护性质。</p>
<p>算法思路：</p>
<ul>
<li>对待插入的Key找到对应的叶节点<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span></eq></li>
<li>若<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span></eq>已经有<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></eq>个Key了，则<em>分裂</em>成两个节点，需要按序将Key平分到两个节点上；否则，直接插入。</li>
<li>若执行了分裂，则新增的节点需要向父节点插入一个新的Key</li>
<li>对父节点插入并递归上述算法（父节点可能还要分裂）</li>
<li>若最终把根节点分裂了，则B+树<em>增高</em>一层：为原根节点分裂出来的两个节点添加一个共同的父节点充当新的根节点</li>
</ul>
<h3 id="b%2B%E6%A0%91%E5%88%A0%E9%99%A4" tabindex="-1">B+树删除</h3>
<p>主要是利用<em>重新分布(Redistribution)</em>、<em>合并</em>以及变矮来维护性质。</p>
<h2 id="hash%E7%B4%A2%E5%BC%95%EF%BC%88%E5%BE%85%E5%AE%8C%E5%96%84%EF%BC%89" tabindex="-1">Hash索引（待完善）</h2>
<h3 id="hash%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87" tabindex="-1">Hash文件组织</h3>
<h3 id="%E6%A1%B6%E6%BA%A2%E5%87%BA%E5%A4%84%E7%90%86" tabindex="-1">桶溢出处理</h3>
<p>两种起因：</p>
<ul>
<li>Hash表的容量耗尽</li>
<li>（更常见）由于记录的*倾斜(skew)*导致的个别桶溢出</li>
</ul>
<p>个别桶的溢出对标的是Hash表中的<em>冲突</em>。</p>
<p>自然，有两种处理溢出的手法：</p>
<ul>
<li>Closed Hashing 使用一个溢出链来存放溢出的记录，相当于<em>链接法</em></li>
<li>Opened Hashing 其实就是<em>开放寻址法</em></li>
</ul>
<p>通常，数据库使用Closed Hashing解决溢出。因为数据库中增删改查都比较多。</p>
<h3 id="hash%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6" tabindex="-1">Hash索引文件</h3>
<p>Hash索引是以Hash文件组织结果构建的非聚簇索引。</p>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.min.css">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://pumpkinjimmy.github.io/posts/326791a4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BBPumpkin">
      <meta itemprop="description" content="BBPumpkin的个人博客( •̀ ω •́ )y">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BBPumpkin的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/326791a4/" class="post-title-link" itemprop="url">DBMS底层：记录管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-15 02:06:05" itemprop="dateCreated datePublished" datetime="2021-11-15T02:06:05+08:00">2021-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-08 18:10:11" itemprop="dateModified" datetime="2023-06-08T18:10:11+08:00">2023-06-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="dbms%E5%BA%95%E5%B1%82%EF%BC%9A%E8%AE%B0%E5%BD%95%E7%AE%A1%E7%90%86" tabindex="-1">DBMS底层：记录管理</h1>
<h2 id="%E5%AE%9A%E9%95%BF%E8%AE%B0%E5%BD%95" tabindex="-1">定长记录</h2>
<p>定长记录的删除：</p>
<ul>
<li>压缩：删除记录，后面的记录全部前移</li>
<li>交换：将最后面的记录交换到删除记录的位置</li>
<li>删除（空余）记录链表：在记录的最开始增加一个指针记录，作为链表头指针。链表记录着空余（被删除）记录的空间，方便重用。</li>
</ul>
<h2 id="%E5%8F%98%E9%95%BF%E8%AE%B0%E5%BD%95" tabindex="-1">变长记录</h2>
<p>表示方案：<br>
（待完善）</p>
<h3 id="slotted-page-struture" tabindex="-1">Slotted Page Struture</h3>
<p>根据磁盘读写的特点组织每一个页的数据结构：Slotted Page Struture。</p>
<p>Slotted Page Struture其实是微缩的文件系统存储组织，包含如下内容：</p>
<ul>
<li>record count</li>
<li><strong>record location and size</strong></li>
<li><strong>free space pointer</strong></li>
</ul>
<h2 id="%E8%AE%B0%E5%BD%95%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87" tabindex="-1">记录文件组织</h2>
<ul>
<li>堆放（Pile,Heap）：没有规律地堆放记录到文件中</li>
<li>顺序文件：顺序存储记录</li>
<li>哈希文件</li>
<li>多表聚集文件（Multitable Clustering File）</li>
</ul>
<h3 id="%E9%A1%BA%E5%BA%8F%E6%96%87%E4%BB%B6" tabindex="-1">顺序文件</h3>
<p>组织方式：</p>
<ul>
<li>顺序存储</li>
<li><strong>单链表组织，每个记录末尾保存着下一个记录的位置。通常就是下一个记录</strong></li>
<li>依据搜索码排序</li>
</ul>
<p>操作方式：</p>
<ul>
<li>删除：删除记录链表</li>
<li>插入：
<ul>
<li>依据搜索码定位</li>
<li>若定位到空余空间，则直接放入</li>
<li>否则，使用<em>overflow block</em>（溢出块）来存储插入的记录。溢出块是不在顺序记录的连续存储空间中的记录，通过后继指针来明确其位置</li>
<li>需要定期重排数据库，整理溢出块到表中</li>
</ul>
</li>
</ul>
<h3 id="%E5%A4%9A%E8%A1%A8%E8%81%9A%E9%9B%86%E6%96%87%E4%BB%B6" tabindex="-1">多表聚集文件</h3>
<p>其实就是<strong>将来自不同表的记录存放到同一个文件中</strong>。</p>
<p>使用这种记录的动机是<strong>加快连接运算的速度</strong>。这种结构使得牵涉到的表的联表的IO页面数减少。</p>
<h2 id="%E5%85%83%E6%95%B0%E6%8D%AE%EF%BC%88%E5%BE%85%E5%AE%8C%E5%96%84%EF%BC%89" tabindex="-1">元数据（待完善）</h2>
<h2 id="%E7%BC%93%E5%AD%98%E7%AE%A1%E7%90%86" tabindex="-1">缓存管理</h2>
<p>数据库性能提升的核心之一就是<strong>最小化磁盘IO</strong></p>
<p>而减少读取的一个重要部分就是缓存，精确的说是<strong>内存缓冲区管理</strong></p>
<h3 id="%E7%BC%93%E5%AD%98%E6%9B%BF%E6%8D%A2%E7%AD%96%E7%95%A5%EF%BC%88%E5%BE%85%E5%AE%8C%E5%96%84%EF%BC%89" tabindex="-1">缓存替换策略（待完善）</h3>
<ul>
<li>LRU</li>
<li>Pinned Block</li>
<li>Toss-immediate</li>
<li>MRU</li>
</ul>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.min.css">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://pumpkinjimmy.github.io/posts/2dc74297/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BBPumpkin">
      <meta itemprop="description" content="BBPumpkin的个人博客( •̀ ω •́ )y">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BBPumpkin的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/2dc74297/" class="post-title-link" itemprop="url">流计算</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-15 00:35:29" itemprop="dateCreated datePublished" datetime="2021-11-15T00:35:29+08:00">2021-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-08 18:10:11" itemprop="dateModified" datetime="2023-06-08T18:10:11+08:00">2023-06-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="%E6%B5%81%E8%AE%A1%E7%AE%97" tabindex="-1">流计算</h1>
<h2 id="storm" tabindex="-1">Storm</h2>
<h3 id="%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5" tabindex="-1">基本概念</h3>
<ul>
<li>
<p>Tuple</p>
<p>可以认为是“行”。</p>
<p>更精确地说，Tuple的意义是一系列Map的ValueList</p>
</li>
<li>
<p>Spout</p>
<p>流数据源，理解为“水龙头”</p>
</li>
<li>
<p>Bolt</p>
<p>计算组件。</p>
<p>他的输入是Tuple流，输出也是Tuple流</p>
</li>
</ul>
<h3 id="topology" tabindex="-1">Topology</h3>
<p>我们将Spout和Bolt作为节点可以构建出一个流计算图Topology。</p>
<p>Bolt通过<em>订阅</em>得到Spout的数据。因此中间会涉及通信中间件。</p>
<p>Topology是Job的最小单位。</p>
<h3 id="grouping" tabindex="-1">Grouping</h3>
<ul>
<li>ShuffleGrouping 随机分组</li>
<li>FieldsGrouping 按字段取值分组</li>
<li>AllGrouping 广播发送，Tuple发往所有后继</li>
<li>NonGrouping 不分组，后继全部在同一个进程</li>
</ul>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.min.css">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://pumpkinjimmy.github.io/posts/94109c97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BBPumpkin">
      <meta itemprop="description" content="BBPumpkin的个人博客( •̀ ω •́ )y">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BBPumpkin的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/94109c97/" class="post-title-link" itemprop="url">分布式系统：同步</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-12 06:40:36" itemprop="dateCreated datePublished" datetime="2021-11-12T06:40:36+08:00">2021-11-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-08 18:10:11" itemprop="dateModified" datetime="2023-06-08T18:10:11+08:00">2023-06-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%EF%BC%9A%E5%90%8C%E6%AD%A5" tabindex="-1">分布式系统：同步</h1>
<h2 id="%E7%89%A9%E7%90%86%E6%97%B6%E9%92%9F%E5%90%8C%E6%AD%A5" tabindex="-1">物理时钟同步</h2>
<p>所谓时钟同步，主要是关注<strong>计算机之间的始终保持一致</strong></p>
<p>物理时钟同步难以依靠单纯的CS技术处理，通常需要物理、通信、电子的技术来解决</p>
<p>两种常见的获取时间方式：</p>
<ul>
<li>
<p>使用接收器接收UTC授时电波中接收</p>
</li>
<li>
<p><strong>从时间服务器中获得时间</strong>（这种方式更常用）</p>
<p>容易看出一个问题，<strong>网络通信本身有延迟，即便服务器的时间是绝对准确的，从服务器获得的时间也有偏差</strong></p>
<p>工程上的解决方案是<strong>使用往返的时间估计延迟，使用延迟最小的一次作准</strong></p>
</li>
</ul>
<p>同步后发现始终不准怎么办：</p>
<ol>
<li>若本地时间比UTC慢，直接调快时钟即可</li>
<li>若本地时间比UTC快，就有问题了：<strong>一旦时钟拨回过去，一些已经产生的记录如何处置</strong>。通常我们不会把时钟回拨。</li>
</ol>
<h2 id="%E9%80%BB%E8%BE%91%E6%97%B6%E9%92%9F%E5%90%8C%E6%AD%A5" tabindex="-1">逻辑时钟同步</h2>
<p>相比物理上的“时间准确”，逻辑上的时钟同步的强调的是<strong>时序正确</strong></p>
<p>逻辑时间不关心具体的时间，它通常讨论的是<em>计数器的计数</em></p>
<h3 id="happen-before" tabindex="-1">Happen-before</h3>
<p>Happen-before是一种事件之间约束，若一个事件在另一个事件之前发生，则它们之间存在Happen-before。</p>
<p>自然中存在基本的、可以不加证明的Happen-before关系，比如说“发送信息发生在接收信息之前”</p>
<h3 id="%E5%9F%BA%E6%9C%AC%E9%80%BB%E8%BE%91%E6%97%B6%E9%92%9F%E7%AE%97%E6%B3%95" tabindex="-1">基本逻辑时钟算法</h3>
<p>考虑存在一个计数器，初始为0</p>
<ol>
<li>每次发生一个新事件，计数器+1</li>
<li>每次发送一个消息时，消息使用计数器的计数作为时间戳</li>
<li>每次接收到一个消息时，系统检查消息的时间戳和计数器的时间。<strong>当前计数器的值设置为两者中较大的一个</strong>。</li>
</ol>
<p>这个简单方法的核心思想就是<strong>发送消息在接收消息之前</strong>。也就是说，如果消息中的时间戳比本地时钟还要领先，则必须调快本地时钟。</p>
<h3 id="%E5%AE%9E%E4%BE%8B%EF%BC%9A%E5%89%AF%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9B%B4%E6%96%B0" tabindex="-1">实例：副本数据库更新</h3>
<p>考虑DB1和DB2是复制数据库，P1和P2是系统的两个操作员：</p>
<ul>
<li>P1为账户存入100元（记作T1），P2为账户结算1%利息（记作T2）</li>
<li>由于是复制数据库，DB1和DB2必须都在数据库上执行T1和T2</li>
<li>但若DB1和DB2在执行T1和T2的顺序上不一样，就会导致账户余额在DB1和DB2上不一致</li>
<li>即便在DB访问中全部使用了正确的数据锁，也有可能产生不一致</li>
</ul>
<p>可以发现：</p>
<ul>
<li>两个事务是并行的</li>
<li>在特定的DB主机而言，正确的程序实现中可能会对账户数据上锁，因此本机上的一致性不成问题。不一致性并不因为操作的汇编指令的交叉执行。</li>
<li>真正的问题出在T1和T2同时在DB1和DB2上执行，修改同一块数据，<strong>但先执行T1还是先执行T2是不确定的，而且T1和T2的执行顺序会影响最终的结果</strong></li>
<li>注意区别OS中的基本竞态问题：<strong>单机中运行的程序里，一旦通过互斥实现临界操作线性化问题就解决了</strong>；但在复制数据库中，<strong>每一个数据库有如平行的世界线，是独立的状态机，我们不但要保证临界操作线性化，还要保证各个副本上的临界操作具有相同的顺序</strong></li>
</ul>
<p>在分布式系统上我们需要比信号量更强的互斥锁。</p>
<h3 id="%E5%85%A8%E5%B1%80%E5%A4%9A%E6%92%AD" tabindex="-1">全局多播</h3>
<p>全局多播可以实现<strong>各副本上进程进入临界区的顺序相同</strong>，更具体地，<strong>保证临界事件在所有节点上的交付(Deliver)顺序相同</strong></p>
<p>Lamport全序多播的实现：</p>
<ul>
<li>
<p>假定通信信道可靠，且消息是<strong>FIFO排序的</strong></p>
<p>说明：FIFO排序是指<em>对发送者而言（对某一信道），先发送的消息先到达</em></p>
</li>
<li>
<p>进程<strong>广播带时间戳的消息</strong>，且消息本身保存在本地队列中不移除</p>
</li>
<li>
<p>对进程（从任何发送者发送的）收到的消息根据时间戳进行排序，并<strong>广播确认消息</strong></p>
</li>
<li>
<p>仅在<strong>消息在接收队列队头，且它被所有进程确认过了，才被交付给进程</strong></p>
</li>
<li>
<p>这里牵涉到的逻辑时钟是：发送消息总是发生在发送确认消息之前。借助这一点可以本地逻辑时钟。</p>
</li>
</ul>
<h2 id="%E4%BA%92%E6%96%A5%E7%AE%97%E6%B3%95" tabindex="-1">互斥算法</h2>
<ul>
<li>Centralized 使用一个Master节点控制所有的临界区访问</li>
<li>Distributed 一个节点需要访问临界区，需要取得所有的节点的同意</li>
<li>Token ring 节点在逻辑上围成环，环中一个令牌（Token）在轮流传递。得到令牌的节点才能访问临界区</li>
<li>Decentralized （待完善）</li>
</ul>
<p>观察发现上面这些互斥算法同样出现在计网的共享信道争用的问题中：</p>
<ul>
<li>Centralized 集中式的信道管理</li>
<li>Take Turn 对应令牌环网</li>
<li>Random Access 对应CSMA/CD以及CSMA/CA</li>
</ul>
<p>本质上是因为<strong>共享信道就是分布式系统中的一种共享资源</strong></p>
<p>上面这些互斥算法都有针对不同场景的混合、改进。</p>
<h2 id="%E9%80%89%E4%B8%BE%E7%AE%97%E6%B3%95" tabindex="-1">选举算法</h2>
<p>以下考虑一种这样的模型：</p>
<ul>
<li>系统中所有进程的ID对所有的进程都是已知的</li>
<li><strong>系统中ID最大的有效节点自动称为Master</strong></li>
</ul>
<h3 id="bully%E7%AE%97%E6%B3%95" tabindex="-1">Bully算法</h3>
<p>则采取如下方式<em>选举</em>出系统的中心节点：</p>
<ol>
<li>当进程<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">P_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq>发现Master失效，则可以发起选举，<strong>向<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>P</mi><mrow><mi>k</mi><mo>+</mo><mn>2</mn></mrow></msub><mo separator="true">,</mo><mo>⋯</mo></mrow><annotation encoding="application/x-tex">P_{k+1}, P_{k+2}, \cdots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span></span></span></span></eq>发送<code>ELECTION</code>消息</strong></li>
<li>若没有得到任何回复，则<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">P_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></eq>成为Master</li>
</ol>
<p>这个算法的思想贴合其名称：<em>霸凌(Bully)</em></p>
<h3 id="ring%E7%AE%97%E6%B3%95" tabindex="-1">Ring算法</h3>
<p>考虑系统节点构成环，当发现Master节点失效的时候，<strong>节点沿着环发送选举消息</strong>，消息转一圈之后就可以重新选举出Master了</p>
<h3 id="%E7%94%9F%E6%88%90%E6%A0%91%E7%AE%97%E6%B3%95" tabindex="-1">生成树算法</h3>
<ol>
<li>按照生成树方法发送消息</li>
<li>向生成树的父亲发送当前了解到的最大节点</li>
<li>最终在树根知道了系统中的最大节点</li>
</ol>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.min.css">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://pumpkinjimmy.github.io/posts/bcfc74fe/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BBPumpkin">
      <meta itemprop="description" content="BBPumpkin的个人博客( •̀ ω •́ )y">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BBPumpkin的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/bcfc74fe/" class="post-title-link" itemprop="url">分布式系统：命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-10 09:26:21" itemprop="dateCreated datePublished" datetime="2021-11-10T09:26:21+08:00">2021-11-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-08 18:10:11" itemprop="dateModified" datetime="2023-06-08T18:10:11+08:00">2023-06-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%EF%BC%9A%E5%91%BD%E5%90%8D" tabindex="-1">分布式系统：命名</h1>
<p>为什么要专门提命名这种看似trivial的东西？</p>
<p>因为在分布式系统中<strong>讨论命名其实是在讨论在系统中如何定位一个资源</strong></p>
<h2 id="%E9%9D%9E%E7%BB%93%E6%9E%84%E5%8C%96%E5%91%BD%E5%90%8D" tabindex="-1">非结构化命名</h2>
<p>所谓<em>非结构化命名</em>其实就是强调<strong>命名与系统结构没有关联，名称中并不蕴含结构化查找的信息</strong></p>
<p>下面讨论两种基于非结构化命名的分布式系统。</p>
<h3 id="dht" tabindex="-1">DHT</h3>
<p>（略）</p>
<p>Chord这种典型的P2P结构中使用最简单粗暴的<strong>哈希值</strong>来命名每个节点，然后依赖每个节点上类似路由表的<strong>Chord Finger Table</strong>来查找。</p>
<p>这种简单结构的分布式存储具有多种好处，但不能满足很多情况下的需求。</p>
<h3 id="%E6%A0%91%E7%BB%93%E6%9E%84" tabindex="-1">树结构</h3>
<p>其实就是使用树结构层次化、分区域地存储和定位资源。</p>
<h2 id="%E7%BB%93%E6%9E%84%E5%8C%96%E5%91%BD%E5%90%8D" tabindex="-1">结构化命名</h2>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/markdown-it-texmath/css/texmath.min.css">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">BBPumpkin</p>
  <div class="site-description" itemprop="description">BBPumpkin的个人博客( •̀ ω •́ )y</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">171</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/PumpkinJimmy" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;PumpkinJimmy" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BBPumpkin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
